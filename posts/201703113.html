<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>AnsibleのGalaxyでLAMP環境を作る方法 | The Vue Point</title>
    <meta name="description" content="The offical blog for the Vue.js project">
    <link rel="stylesheet" href="/assets/style.af0878d8.css">
    <link rel="modulepreload" href="/assets/app.505c8123.js">
    <link rel="modulepreload" href="/assets/posts_201703113.md.3852511d.lean.js">
    
    <meta name="twitter:site" content="@vuejs">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:image" content="https://vuejs.org/images/logo.png">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <script src="https://cdn.usefathom.com/script.js" data-site="NYHGSGQV" defer=""></script>
  <meta name="twitter:title" content="AnsibleのGalaxyでLAMP環境を作る方法 | The Vue Point">
  <meta property="og:title" content="AnsibleのGalaxyでLAMP環境を作る方法 | The Vue Point">
  </head>
  <body>
    <div id="app"><div class="antialiased"><div class="max-w-3xl mx-auto px-4 sm:px-6 xl:max-w-5xl xl:px-0"><nav class="flex justify-between items-center py-10 font-bold"><a class="text-xl" href="/" aria-label="PROTAGRAM"><img class="inline-block mr-2" style="width:36px;height:31px;" alt="logo" src="/logo.svg"><span class="hidden md:inline">PROTAGRAM</span></a><div class="text-sm text-gray-500 leading-5"><a class="hover:text-gray-700" href="https://github.com/kryushiki" target="_blank" rel="noopener"><span class="hidden sm:inline">GitHub </span>Source</a><span class="mr-2 ml-2">·</span><a class="hover:text-gray-700" href="/feed.rss">RSS<span class="hidden sm:inline"> Feed</span></a></div></nav></div><main class="max-w-3xl mx-auto px-4 sm:px-6 xl:max-w-5xl xl:px-0"><article class="xl:divide-y xl:divide-gray-200"><header class="pt-6 xl:pb-10 space-y-1 text-center"><dl><dt class="sr-only">Published on</dt><dd class="text-base leading-6 font-medium text-gray-500"><time datetime="2017-03-13T12:00:00.000Z">March 13, 2017</time></dd></dl><h1 class="text-3xl leading-9 font-extrabold text-gray-900 tracking-tight sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">AnsibleのGalaxyでLAMP環境を作る方法</h1></header><div class="divide-y xl:divide-y-0 divide-gray-200 xl:grid xl:grid-cols-4 xl:gap-x-10 pb-16 xl:pb-20" style="grid-template-rows:auto 1fr;"><dl class="pt-6 pb-10 xl:pt-11 xl:border-b xl:border-gray-200"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center xl:block space-x-8 sm:space-x-12 xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><img src="https://gravatar.com/avatar/eca93da2c67aadafe35d477aa8f454b8" alt="author image" class="w-10 h-10 rounded-full"><dl class="text-sm font-medium leading-5 whitespace-nowrap"><dt class="sr-only">Name</dt><dd class="text-gray-900">Kuriya Ushiki</dd><!----><!----></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 xl:pb-0 xl:col-span-3 xl:row-span-2"><div style="position:relative;" class="prose max-w-none pt-10 pb-8"><div><p>Vagrant上にAnsibleを使ってLAMP環境を作る方法を説明します。</p><hr><p>Vagrant上にAnsibleを使ってLAMP環境を作る方法を説明します。</p><p>今回は<a href="https:/galaxy.ansible.com" target="_blank" rel="noopener noreferrer">Galaxy</a>を使います。</p><h2 id="手順" tabindex="-1">手順 <a class="header-anchor" href="#手順" aria-hidden="true">#</a></h2><p>Vagrantは立ち上がっていると仮定して、それ以降の手順を説明する。</p><h3 id="必要なroleをインストールする" tabindex="-1">必要なroleをインストールする <a class="header-anchor" href="#必要なroleをインストールする" aria-hidden="true">#</a></h3><p>使うroleは以下の通りです。</p><ul><li><a href="https://github.com/geerlingguy/ansible-role-apache" target="_blank" rel="noopener noreferrer">geerlingguy/ansible-role-apache</a></li><li><a href="https://github.com/geerlingguy/ansible-role-php" target="_blank" rel="noopener noreferrer">geerlingguy/ansible-role-php</a></li><li><a href="https://github.com/geerlingguy/ansible-role-mysql" target="_blank" rel="noopener noreferrer">geerlingguy/ansible-role-mysql</a></li><li><a href="https://github.com/geerlingguy/ansible-role-composer" target="_blank" rel="noopener noreferrer">geerlingguy/ansible-role-composer</a></li><li><a href="https://github.com/geerlingguy/ansible-role-repo-remi" target="_blank" rel="noopener noreferrer">geerlingguy/ansible-role-repo-remi</a></li></ul><p>これらをダウンロードする。</p><div class="language-"><pre><code>$ ansible-galaxy install --roles-path roles geerlingguy.apache
$ ansible-galaxy install --roles-path roles geerlingggguy.php
$ ansible-galaxy install --roles-path roles geerlingguy.mysql
$ ansible-galaxy install --roles-path roles geerlingguy.composer
$ ansible-galaxy install --roles-path roles geerlingguy.repo-remi
</code></pre></div><p><code>--roles-path roles</code>をつけることでrolesというディレクトリ内にダウンロードされる。 たしかrolesというディレクトリがない場合は自動で作ってくれる。</p><h3 id="playbookを作成" tabindex="-1">playbookを作成 <a class="header-anchor" href="#playbookを作成" aria-hidden="true">#</a></h3><p>playbookは任意の名前で良いので今回はlamp.ymlを作成します。 <code>touch lamp.yml</code> そしたらファイルの中身を変更します。 最小限良ければ以下のようになります。</p><div class="language-yaml"><pre><code><span class="token punctuation">---</span>
<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> all
  <span class="token key atrule">roles</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> geerlingguy.mysql
  <span class="token punctuation">-</span> geerlingguy.apache
  <span class="token punctuation">-</span> geerlingguy.php
  <span class="token punctuation">-</span> geerlingguy.php
  <span class="token punctuation">-</span> geerlingguy.repo<span class="token punctuation">-</span>remi
  
</code></pre></div><p>ただこれだけだと後で設定しなくてはいけなくなる箇所が出てくると思うのでとりあえず必要そうな設定を紹介します。</p><div class="language-yaml"><pre><code><span class="token punctuation">---</span>
<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> all
  <span class="token key atrule">become</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">roles</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> geerlingguy.mysql
      <span class="token key atrule">vars</span><span class="token punctuation">:</span>
      <span class="token key atrule">mysql_databases</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> dbname <span class="token comment">#dbの名前</span>
          <span class="token key atrule">collation</span><span class="token punctuation">:</span> utf8_general_ci
          <span class="token key atrule">encoding</span><span class="token punctuation">:</span> utf8
          <span class="token key atrule">replicate</span><span class="token punctuation">:</span> <span class="token number">1</span>
      <span class="token key atrule">mysql_users</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> dbuser　<span class="token comment">#のDBのuser名</span>
          <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost
          <span class="token key atrule">password</span><span class="token punctuation">:</span> password <span class="token comment">#DBのuserのパスワード</span>
          <span class="token key atrule">priv</span><span class="token punctuation">:</span> <span class="token string">&quot;dbname.*:ALL&quot;</span> <span class="token comment">#userの権限 今回の記述でdbuserにdbnameのすべての権限を付与する</span>
      <span class="token key atrule">tags</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> mysql
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> geerlingguy.apache
      <span class="token key atrule">vars</span><span class="token punctuation">:</span>
      <span class="token key atrule">apache_vhosts</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">servername</span><span class="token punctuation">:</span> <span class="token string">&quot;local.dev&quot;</span>
          <span class="token key atrule">documentroot</span><span class="token punctuation">:</span> <span class="token string">&quot;/var/www/sprix&quot;</span> <span class="token comment">#apacheで設定の設定キュメントルートの設定</span>
      <span class="token key atrule">tags</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> apache
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> geerlingguy.repo<span class="token punctuation">-</span>remi
      <span class="token key atrule">vars</span><span class="token punctuation">:</span>
      <span class="token key atrule">ansible_distribution_major_version</span><span class="token punctuation">:</span> <span class="token number">6</span> <span class="token comment">#CentOS6系という意味の6</span>
      <span class="token key atrule">tags</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> repo<span class="token punctuation">-</span>remi
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> geerlingguy.php
      <span class="token key atrule">vars</span><span class="token punctuation">:</span>
      <span class="token key atrule">php_packages</span><span class="token punctuation">:</span> <span class="token comment">#phpに入れたいパッケージを記述する。</span>
        <span class="token punctuation">-</span> php<span class="token punctuation">-</span>pdo_mysql
        <span class="token punctuation">-</span> php<span class="token punctuation">-</span>pecl<span class="token punctuation">-</span>xdebug
      <span class="token key atrule">php_enablerepo</span><span class="token punctuation">:</span> <span class="token string">&quot;remi&quot;</span>
      <span class="token key atrule">php_packages_state</span><span class="token punctuation">:</span> latest
      <span class="token key atrule">php_install_recommends</span><span class="token punctuation">:</span> yes
      <span class="token key atrule">php_date_timezone</span><span class="token punctuation">:</span> <span class="token string">&quot;Asia/Tokyo&quot;</span>
      <span class="token key atrule">xdebug_remote_enable</span><span class="token punctuation">:</span> On
      <span class="token key atrule">xdebug_remote_autostart</span><span class="token punctuation">:</span> On
      <span class="token key atrule">xdebug_remote_host</span><span class="token punctuation">:</span> 192.168.33.1
      <span class="token key atrule">xdebug_remote_port</span><span class="token punctuation">:</span> <span class="token number">9000</span>
      <span class="token key atrule">xdebug_idekey</span><span class="token punctuation">:</span> phpstorm_xdebug <span class="token comment">#任意</span>
      <span class="token key atrule">xdebug_remote_connect_back</span><span class="token punctuation">:</span> On
      <span class="token key atrule">tags</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> php
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> geerlingguy.composer
      <span class="token key atrule">vars</span><span class="token punctuation">:</span>
      <span class="token key atrule">composer_path</span><span class="token punctuation">:</span> /usr/local/bin/composer
      <span class="token key atrule">composer_home_path</span><span class="token punctuation">:</span> <span class="token string">&#39;~/.composer&#39;</span>
      <span class="token key atrule">tags</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> composer
</code></pre></div><p>roles/{各role} /defaults/main.ymlにデフォルトの設定値が書かれている。 こちらを編集しても良いのだが、出来れば設定値は外に出してあげた方が良いので、必要な箇所だけ取り出してplaybookに記述したほうが良い。</p><h3 id="investroyをダウンロードする" tabindex="-1">investroyをダウンロードする <a class="header-anchor" href="#investroyをダウンロードする" aria-hidden="true">#</a></h3><p>vagrant用のinvestroyをダウンロード <code>curl -O https://raw.githubusercontent.com/ansible/ansible/devel/contrib/inventory/vagrant.py</code></p><h3 id="playbookを実行する。" tabindex="-1">playbookを実行する。 <a class="header-anchor" href="#playbookを実行する。" aria-hidden="true">#</a></h3><p><code>ansible-playbook -i vagrant.py -s lamp.yml</code></p><h4 id="roleを個別に実行したい場合" tabindex="-1">roleを個別に実行したい場合 <a class="header-anchor" href="#roleを個別に実行したい場合" aria-hidden="true">#</a></h4><p>lamp.ymlで設定したtagsを使う。 phpであれば以下のようにして使う。 ex <code>ansible-playbook -i vagrant.py lamp.yml --tags=&quot;php&quot;</code></p><h3 id="参考サイト" tabindex="-1">参考サイト <a class="header-anchor" href="#参考サイト" aria-hidden="true">#</a></h3><ul><li><a href="https://www.jeffgeerling.com/blog/using-ansible-galaxy" target="_blank" rel="noopener noreferrer">https://www.jeffgeerling.com/blog/using-ansible-galaxy</a></li><li><a href="http://knowledge.sakura.ad.jp/tech/3116/" target="_blank" rel="noopener noreferrer">http://knowledge.sakura.ad.jp/tech/3116/</a></li></ul></div></div></div><footer class="text-sm font-medium leading-5 divide-y divide-gray-200 xl:col-start-1 xl:row-start-2"><div class="py-8"><h2 class="text-xs tracking-wide uppercase text-gray-500"> Next Article </h2><div class="link"><a href="/posts/201703114.html">MAMPのDBにSequel Proでアクセスする方法</a></div></div><div class="py-8"><h2 class="text-xs tracking-wide uppercase text-gray-500"> Previous Article </h2><div class="link"><a href="/posts/201703112.html">bootstrapのハンバーガーメニューにエフェクトをつける方法</a></div></div><div class="pt-8"><a class="link" href="/">← Back to the blog</a></div></footer></div></article></main></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"index.md\":\"bbe87050\",\"posts_20170301.md\":\"7a3ce58a\",\"posts_20170302.md\":\"d0af4d50\",\"posts_20170303.md\":\"5d077dc3\",\"posts_20170304.md\":\"b9b8e56b\",\"posts_20170305.md\":\"5b6337f6\",\"posts_20170306.md\":\"8be4fd58\",\"posts_20170307.md\":\"3e3bf942\",\"posts_20170308-draft.md\":\"560cda62\",\"posts_20170309.md\":\"fa533d43\",\"posts_20170310.md\":\"13071d01\",\"posts_20170311.md\":\"ad7f6227\",\"posts_201703112.md\":\"92bb1571\",\"posts_201703113.md\":\"3852511d\",\"posts_201703114.md\":\"8be6e4f9\",\"posts_201703115.md\":\"051eea19\",\"posts_201703116.md\":\"0aec5ec9\",\"posts_201703117.md\":\"0afabaf0\",\"posts_20210211.md\":\"86828948\",\"posts_20210212.md\":\"8cca5628\"}")</script>
    <script type="module" async src="/assets/app.505c8123.js"></script>
    
  </body>
</html>