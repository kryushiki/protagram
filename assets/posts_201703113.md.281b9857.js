import{_ as a,c as n,o as s,a as e}from"./app.bd02baaa.js";const t='{"title":"AnsibleのGalaxyでLAMP環境を作る方法","description":"","frontmatter":{"title":"AnsibleのGalaxyでLAMP環境を作る方法","date":"2017-03-13T00:00:00.000Z","author":"Kuriya Ushiki","gravatar":"eca93da2c67aadafe35d477aa8f454b8","category":"infrastructure","tags":["ansible","apache","composer","mysql","php"]},"headers":[{"level":2,"title":"手順","slug":"手順"},{"level":3,"title":"必要なroleをインストールする","slug":"必要なroleをインストールする"},{"level":3,"title":"playbookを作成","slug":"playbookを作成"},{"level":3,"title":"investroyをダウンロードする","slug":"investroyをダウンロードする"},{"level":3,"title":"playbookを実行する。","slug":"playbookを実行する。"},{"level":3,"title":"参考サイト","slug":"参考サイト"}],"relativePath":"posts/201703113.md","lastUpdated":1644987604493}',p={},o=[e('<p>Vagrant上にAnsibleを使ってLAMP環境を作る方法を説明します。</p><hr><p>Vagrant上にAnsibleを使ってLAMP環境を作る方法を説明します。</p><p>今回は<a href="https:/galaxy.ansible.com" target="_blank" rel="noopener noreferrer">Galaxy</a>を使います。</p><h2 id="手順" tabindex="-1">手順 <a class="header-anchor" href="#手順" aria-hidden="true">#</a></h2><p>Vagrantは立ち上がっていると仮定して、それ以降の手順を説明する。</p><h3 id="必要なroleをインストールする" tabindex="-1">必要なroleをインストールする <a class="header-anchor" href="#必要なroleをインストールする" aria-hidden="true">#</a></h3><p>使うroleは以下の通りです。</p><ul><li><a href="https://github.com/geerlingguy/ansible-role-apache" target="_blank" rel="noopener noreferrer">geerlingguy/ansible-role-apache</a></li><li><a href="https://github.com/geerlingguy/ansible-role-php" target="_blank" rel="noopener noreferrer">geerlingguy/ansible-role-php</a></li><li><a href="https://github.com/geerlingguy/ansible-role-mysql" target="_blank" rel="noopener noreferrer">geerlingguy/ansible-role-mysql</a></li><li><a href="https://github.com/geerlingguy/ansible-role-composer" target="_blank" rel="noopener noreferrer">geerlingguy/ansible-role-composer</a></li><li><a href="https://github.com/geerlingguy/ansible-role-repo-remi" target="_blank" rel="noopener noreferrer">geerlingguy/ansible-role-repo-remi</a></li></ul><p>これらをダウンロードする。</p><div class="language-"><pre><code>$ ansible-galaxy install --roles-path roles geerlingguy.apache\n$ ansible-galaxy install --roles-path roles geerlingggguy.php\n$ ansible-galaxy install --roles-path roles geerlingguy.mysql\n$ ansible-galaxy install --roles-path roles geerlingguy.composer\n$ ansible-galaxy install --roles-path roles geerlingguy.repo-remi\n</code></pre></div><p><code>--roles-path roles</code>をつけることでrolesというディレクトリ内にダウンロードされる。 たしかrolesというディレクトリがない場合は自動で作ってくれる。</p><h3 id="playbookを作成" tabindex="-1">playbookを作成 <a class="header-anchor" href="#playbookを作成" aria-hidden="true">#</a></h3><p>playbookは任意の名前で良いので今回はlamp.ymlを作成します。 <code>touch lamp.yml</code> そしたらファイルの中身を変更します。 最小限良ければ以下のようになります。</p><div class="language-yaml"><pre><code><span class="token punctuation">---</span>\n<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> all\n  <span class="token key atrule">roles</span><span class="token punctuation">:</span>\n  <span class="token punctuation">-</span> geerlingguy.mysql\n  <span class="token punctuation">-</span> geerlingguy.apache\n  <span class="token punctuation">-</span> geerlingguy.php\n  <span class="token punctuation">-</span> geerlingguy.php\n  <span class="token punctuation">-</span> geerlingguy.repo<span class="token punctuation">-</span>remi\n  \n</code></pre></div><p>ただこれだけだと後で設定しなくてはいけなくなる箇所が出てくると思うのでとりあえず必要そうな設定を紹介します。</p><div class="language-yaml"><pre><code><span class="token punctuation">---</span>\n<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> all\n  <span class="token key atrule">become</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>\n  <span class="token key atrule">roles</span><span class="token punctuation">:</span>\n    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> geerlingguy.mysql\n      <span class="token key atrule">vars</span><span class="token punctuation">:</span>\n      <span class="token key atrule">mysql_databases</span><span class="token punctuation">:</span>\n        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> dbname <span class="token comment">#dbの名前</span>\n          <span class="token key atrule">collation</span><span class="token punctuation">:</span> utf8_general_ci\n          <span class="token key atrule">encoding</span><span class="token punctuation">:</span> utf8\n          <span class="token key atrule">replicate</span><span class="token punctuation">:</span> <span class="token number">1</span>\n      <span class="token key atrule">mysql_users</span><span class="token punctuation">:</span>\n        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> dbuser　<span class="token comment">#のDBのuser名</span>\n          <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost\n          <span class="token key atrule">password</span><span class="token punctuation">:</span> password <span class="token comment">#DBのuserのパスワード</span>\n          <span class="token key atrule">priv</span><span class="token punctuation">:</span> <span class="token string">&quot;dbname.*:ALL&quot;</span> <span class="token comment">#userの権限 今回の記述でdbuserにdbnameのすべての権限を付与する</span>\n      <span class="token key atrule">tags</span><span class="token punctuation">:</span>\n        <span class="token punctuation">-</span> mysql\n    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> geerlingguy.apache\n      <span class="token key atrule">vars</span><span class="token punctuation">:</span>\n      <span class="token key atrule">apache_vhosts</span><span class="token punctuation">:</span>\n        <span class="token punctuation">-</span> <span class="token key atrule">servername</span><span class="token punctuation">:</span> <span class="token string">&quot;local.dev&quot;</span>\n          <span class="token key atrule">documentroot</span><span class="token punctuation">:</span> <span class="token string">&quot;/var/www/sprix&quot;</span> <span class="token comment">#apacheで設定の設定キュメントルートの設定</span>\n      <span class="token key atrule">tags</span><span class="token punctuation">:</span>\n        <span class="token punctuation">-</span> apache\n    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> geerlingguy.repo<span class="token punctuation">-</span>remi\n      <span class="token key atrule">vars</span><span class="token punctuation">:</span>\n      <span class="token key atrule">ansible_distribution_major_version</span><span class="token punctuation">:</span> <span class="token number">6</span> <span class="token comment">#CentOS6系という意味の6</span>\n      <span class="token key atrule">tags</span><span class="token punctuation">:</span>\n        <span class="token punctuation">-</span> repo<span class="token punctuation">-</span>remi\n    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> geerlingguy.php\n      <span class="token key atrule">vars</span><span class="token punctuation">:</span>\n      <span class="token key atrule">php_packages</span><span class="token punctuation">:</span> <span class="token comment">#phpに入れたいパッケージを記述する。</span>\n        <span class="token punctuation">-</span> php<span class="token punctuation">-</span>pdo_mysql\n        <span class="token punctuation">-</span> php<span class="token punctuation">-</span>pecl<span class="token punctuation">-</span>xdebug\n      <span class="token key atrule">php_enablerepo</span><span class="token punctuation">:</span> <span class="token string">&quot;remi&quot;</span>\n      <span class="token key atrule">php_packages_state</span><span class="token punctuation">:</span> latest\n      <span class="token key atrule">php_install_recommends</span><span class="token punctuation">:</span> yes\n      <span class="token key atrule">php_date_timezone</span><span class="token punctuation">:</span> <span class="token string">&quot;Asia/Tokyo&quot;</span>\n      <span class="token key atrule">xdebug_remote_enable</span><span class="token punctuation">:</span> On\n      <span class="token key atrule">xdebug_remote_autostart</span><span class="token punctuation">:</span> On\n      <span class="token key atrule">xdebug_remote_host</span><span class="token punctuation">:</span> 192.168.33.1\n      <span class="token key atrule">xdebug_remote_port</span><span class="token punctuation">:</span> <span class="token number">9000</span>\n      <span class="token key atrule">xdebug_idekey</span><span class="token punctuation">:</span> phpstorm_xdebug <span class="token comment">#任意</span>\n      <span class="token key atrule">xdebug_remote_connect_back</span><span class="token punctuation">:</span> On\n      <span class="token key atrule">tags</span><span class="token punctuation">:</span>\n        <span class="token punctuation">-</span> php\n    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> geerlingguy.composer\n      <span class="token key atrule">vars</span><span class="token punctuation">:</span>\n      <span class="token key atrule">composer_path</span><span class="token punctuation">:</span> /usr/local/bin/composer\n      <span class="token key atrule">composer_home_path</span><span class="token punctuation">:</span> <span class="token string">&#39;~/.composer&#39;</span>\n      <span class="token key atrule">tags</span><span class="token punctuation">:</span>\n        <span class="token punctuation">-</span> composer\n</code></pre></div><p>roles/{各role} /defaults/main.ymlにデフォルトの設定値が書かれている。 こちらを編集しても良いのだが、出来れば設定値は外に出してあげた方が良いので、必要な箇所だけ取り出してplaybookに記述したほうが良い。</p><h3 id="investroyをダウンロードする" tabindex="-1">investroyをダウンロードする <a class="header-anchor" href="#investroyをダウンロードする" aria-hidden="true">#</a></h3><p>vagrant用のinvestroyをダウンロード <code>curl -O https://raw.githubusercontent.com/ansible/ansible/devel/contrib/inventory/vagrant.py</code></p><h3 id="playbookを実行する。" tabindex="-1">playbookを実行する。 <a class="header-anchor" href="#playbookを実行する。" aria-hidden="true">#</a></h3><p><code>ansible-playbook -i vagrant.py -s lamp.yml</code></p><h4 id="roleを個別に実行したい場合" tabindex="-1">roleを個別に実行したい場合 <a class="header-anchor" href="#roleを個別に実行したい場合" aria-hidden="true">#</a></h4><p>lamp.ymlで設定したtagsを使う。 phpであれば以下のようにして使う。 ex <code>ansible-playbook -i vagrant.py lamp.yml --tags=&quot;php&quot;</code></p><h3 id="参考サイト" tabindex="-1">参考サイト <a class="header-anchor" href="#参考サイト" aria-hidden="true">#</a></h3><ul><li><a href="https://www.jeffgeerling.com/blog/using-ansible-galaxy" target="_blank" rel="noopener noreferrer">https://www.jeffgeerling.com/blog/using-ansible-galaxy</a></li><li><a href="http://knowledge.sakura.ad.jp/tech/3116/" target="_blank" rel="noopener noreferrer">http://knowledge.sakura.ad.jp/tech/3116/</a></li></ul>',26)];var l=a(p,[["render",function(a,e,t,p,l,r){return s(),n("div",null,o)}]]);export{t as __pageData,l as default};
